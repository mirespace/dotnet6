From f8e115fadf6e8b392fa007e78d9b77fc64590cdd Mon Sep 17 00:00:00 2001
From: Daniel Plaisted <dsplaisted@gmail.com>
Date: Mon, 29 Nov 2021 20:19:30 -0800
Subject: [PATCH] Don't set ulimit

1ES pools should now have ulimit set already now
---
 build.sh     | 4 +---
 run-build.sh | 4 ----
 2 files changed, 1 insertion(+), 7 deletions(-)

diff --git a/build.sh b/build.sh
index 594a355fafa..7ff647c4060 100755
--- a/build.sh
+++ b/build.sh
@@ -53,7 +53,5 @@ dockerbuild()
 if [ ! -z "$BUILD_IN_DOCKER" ]; then
     dockerbuild $args
 else
-    # Run under sudo so we can set ulimit
-    # See https://github.com/dotnet/core-eng/issues/14808
-    sudo -E $DIR/run-build.sh $args
+    $DIR/run-build.sh $args
 fi
diff --git a/run-build.sh b/run-build.sh
index fe839eb8009..7b98aedc0be 100755
--- a/run-build.sh
+++ b/run-build.sh
@@ -25,10 +25,6 @@ CUSTOM_BUILD_ARGS=
 # Set nuget package cache under the repo
 [ -z $NUGET_PACKAGES ] && export NUGET_PACKAGES="$REPOROOT/.nuget/packages"
 
-# Set max number of files open, helps avoid errors during NuGet restore
-# See https://github.com/dotnet/core-eng/issues/14808
-ulimit -n 16384
-
 args=( )
 
 while [[ $# > 0 ]]; do
